# YOLOv8 Nano - Stitch Line Detection
## Project Instructions

### Overview
This project uses YOLOv8 nano model for stitch line detection with real-time webcam inference.

### Required Libraries
The following Python libraries are required:
- ultralytics (YOLOv8 framework)
- opencv-python (Computer vision and webcam handling)
- numpy (Numerical computing)
- torch (PyTorch for deep learning)

### Installation Steps

1. **Create and Activate Virtual Environment** (Optional but recommended):
   ```
   python -m venv .venv
   .venv\Scripts\activate  # On Windows
   source .venv/bin/activate  # On Linux/Mac
   ```

2. **Install Required Libraries**:
   ```
   pip install ultralytics opencv-python numpy torch
   ```

   Or install from requirements file if available:
   ```
   pip install -r requirements.txt
   ```

### Project Structure
- dataset/
  - images/          # Training, validation, and test images
    - train/
    - valid/
    - test/
  - labels/          # YOLO format annotations
    - train/
    - valid/
    - test/
  - runs/            # Training outputs and model weights
    - segment/
      - train/
      - train2/
      - train3/
      - train4/       # Latest training run
  - _annotations.coco.json  # Original COCO annotations
  - convert_coco_to_yolo.py # Script to convert COCO to YOLO format
  - data.yaml              # Dataset configuration file
  - webcam_inference.py    # Real-time webcam inference script
  - yolov8n-seg.pt        # YOLOv8 nano segmentation pretrained model

### Usage

1. **Convert COCO Annotations to YOLO Format** (if needed):
   ```
   cd dataset
   python convert_coco_to_yolo.py
   ```

2. **Train the Model** (if not already trained):
   ```python
   from ultralytics import YOLO
   
   # Load a pretrained model
   model = YOLO('yolov8n-seg.pt')
   
   # Train the model
   results = model.train(
       data='data.yaml',
       epochs=100,
       imgsz=640,
       batch=16,
       name='train'
   )
   ```

3. **Run Webcam Inference**:
   ```
   python webcam_inference.py
   ```
   - Press 'q' to quit the webcam window
   - The inference runs at 10 FPS by default
   - Confidence threshold is set to 0.3 (30%)

### Configuration

**data.yaml Settings:**
- Path: Full path to the dataset folder
- train/val/test: Relative paths to image folders
- names: Class names (currently only 'stitch_line')

**webcam_inference.py Settings:**
You can modify:
- `target_fps`: FPS limit (default: 10)
- `conf`: Confidence threshold (default: 0.3)
- Model path: Change to use different trained weights

### Model Weights
The trained model weights are located in:
`runs/segment/train4/weights/best.pt`

### Troubleshooting

1. **Webcam not opening:**
   - Check if another application is using the webcam
   - Try changing the camera index in cv2.VideoCapture(0) to 1 or 2

2. **CUDA/GPU errors:**
   - Make sure you have the correct PyTorch version for your CUDA version
   - Or use CPU inference (slower but works without GPU)

3. **Module not found errors:**
   - Make sure all required libraries are installed
   - Activate your virtual environment if using one

4. **Low inference speed:**
   - Reduce image size in model configuration
   - Increase FPS limit only if your hardware supports it
   - Use GPU if available

### Additional Resources
- YOLOv8 Documentation: https://docs.ultralytics.com/
- OpenCV Documentation: https://docs.opencv.org/

### Notes
- The model is trained to detect stitch lines only
- Masks are displayed without bounding boxes or labels
- FPS is limited to 10 to prevent system overload
